<!DOCTYPE html>

<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>JaKòb - Payment Confirmation</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ea2a33",
                        "primary-dark": "#c91b24",
                        "background-light": "#f8f6f6",
                        "background-dark": "#211111",
                        "surface-dark": "#2f1a1b",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "1rem", "sm": "0.5rem", "md": "0.75rem", "lg": "1.5rem", "xl": "2rem", "2xl": "2.5rem", "3xl": "3rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        /* Custom pattern for background texture */
        .taino-pattern {
            background-color: #211111;
            background-image:  repeating-radial-gradient( circle at 0 0, transparent 0, #211111 40px ), repeating-linear-gradient( #2a151555, #2a151555 );
        }
        /* Gradient for the card glow */
        .card-glow {
            box-shadow: 0 0 40px -10px rgba(234, 42, 51, 0.3);
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-white overflow-x-hidden min-h-screen flex flex-col items-center justify-center taino-pattern">
<!-- Main Container simulating mobile screen -->
<div class="relative w-full max-w-md min-h-screen flex flex-col justify-between">
<!-- Top App Bar -->
<div class="flex items-center p-4 pt-6 justify-between z-10">
<a href="home.html" class="text-white/70 hover:text-white transition-colors flex size-12 shrink-0 items-center justify-center rounded-full bg-white/5 backdrop-blur-sm">
<span class="material-symbols-outlined">close</span>
</a>
<!-- Hidden title for spacing balance, or can be explicit -->
<div class="size-12"></div>
</div>
<!-- Scrollable Content Area -->
<div class="flex-1 flex flex-col items-center px-6 pt-2 pb-8 gap-8">
<!-- Success Animation / Icon -->
<div class="relative flex items-center justify-center mt-4">
<div class="absolute inset-0 bg-primary/20 blur-3xl rounded-full scale-150 animate-pulse"></div>
<div class="relative bg-gradient-to-br from-primary to-primary-dark rounded-full p-8 shadow-[0_0_50px_rgba(234,42,51,0.4)] border-4 border-surface-dark">
<span class="material-symbols-outlined text-white !text-6xl">favorite</span>
</div>
<!-- Decor elements inspired by Veve/Taino symbols (abstract shapes) -->
<div class="absolute -top-4 -right-4 text-primary/40 rotate-12">
<span class="material-symbols-outlined !text-5xl">sunny</span>
</div>
<div class="absolute -bottom-2 -left-4 text-primary/40 -rotate-12">
<span class="material-symbols-outlined !text-5xl">spa</span>
</div>
</div>
<!-- Header Text -->
<div class="text-center space-y-2 z-10">
<h1 class="text-4xl font-black tracking-tight text-white drop-shadow-lg">
                    Mèsi Anpil!
                </h1>
<p class="text-white/80 text-lg font-medium max-w-[280px] mx-auto leading-snug">
                    Success! Your support keeps the culture alive.
                </p>
</div>
<!-- Donation Receipt Card -->
<div class="w-full bg-surface-dark/90 backdrop-blur-md border border-white/10 rounded-xl p-1 shadow-2xl card-glow mt-2">
<!-- Recipient Image Header -->
<div id="recipientBanner" class="relative h-32 rounded-lg overflow-hidden bg-cover bg-center">
<div class="absolute inset-0 bg-gradient-to-t from-surface-dark to-transparent"></div>
<div class="absolute -bottom-8 left-0 right-0 flex justify-center">
<div class="p-1 bg-surface-dark rounded-full">
<img id="recipientAvatar" alt="Creator profile" class="w-16 h-16 rounded-full border-2 border-primary object-cover"/>
</div>
</div>
</div>
<!-- Receipt Details -->
<div class="pt-10 pb-6 px-4 flex flex-col items-center text-center gap-1">
<p class="text-white/60 text-sm font-medium uppercase tracking-wider">You donated</p>
<div id="donationAmount" class="text-4xl font-bold text-white mb-2 tracking-tight">
                        0 <span class="text-xl align-top text-primary">HTG</span>
</div>
<div class="w-full h-px bg-white/10 my-3"></div>
<div class="flex items-center justify-between w-full px-4 text-sm">
<span class="text-white/60">Recipient</span>
<span id="recipientName" class="text-white font-bold">Loading...</span>
</div>
<div class="flex items-center justify-between w-full px-4 text-sm mt-2">
<span class="text-white/60">Campaign</span>
<span id="campaignTitle" class="text-white font-bold text-right">Loading...</span>
</div>
<div class="flex items-center justify-between w-full px-4 text-sm mt-2">
<span class="text-white/60">Method</span>
<div class="flex items-center gap-2">
<span id="paymentMethod" class="text-white font-bold">Loading...</span>
<span class="material-symbols-outlined text-green-500 !text-sm">check_circle</span>
</div>
</div>
<div class="flex items-center justify-between w-full px-4 text-sm mt-2">
<span class="text-white/60">Transaction ID</span>
<span id="transactionId" class="text-white/60 font-mono text-xs">Loading...</span>
</div>
</div>
</div>
<!-- Reaction Bar -->
<div class="flex w-full justify-between items-center px-2">
<button class="flex flex-col items-center gap-1 group">
<div class="p-3 rounded-full bg-white/5 group-hover:bg-primary/20 transition-all border border-white/5">
<span class="material-symbols-outlined text-primary group-hover:scale-110 transition-transform">favorite</span>
</div>
<span class="text-xs font-bold text-primary/80 uppercase tracking-wider">Like</span>
</button>
<button class="flex flex-col items-center gap-1 group">
<div class="p-3 rounded-full bg-white/5 group-hover:bg-primary/20 transition-all border border-white/5">
<span class="material-symbols-outlined text-primary group-hover:scale-110 transition-transform">ios_share</span>
</div>
<span class="text-xs font-bold text-primary/80 uppercase tracking-wider">Share</span>
</button>
<button class="flex flex-col items-center gap-1 group">
<div class="p-3 rounded-full bg-white/5 group-hover:bg-primary/20 transition-all border border-white/5">
<span class="material-symbols-outlined text-primary group-hover:scale-110 transition-transform">receipt_long</span>
</div>
<span class="text-xs font-bold text-primary/80 uppercase tracking-wider">Receipt</span>
</button>
</div>
</div>
<!-- Footer Actions -->
<div class="p-6 bg-gradient-to-t from-background-dark via-background-dark to-transparent w-full">
<a href="home.html" class="w-full flex items-center justify-center h-14 bg-primary hover:bg-primary-dark active:scale-[0.98] transition-all text-white text-lg font-bold rounded-full shadow-[0_4px_20px_rgba(234,42,51,0.4)] tracking-wide">
                Done
            </a>
<p class="text-center text-white/30 text-xs mt-4 font-medium">
                JaKòb - Empowering Creators
            </p>
</div>
</div>
    <!-- User Data Loader -->
    <script src="/assets/js/user-data.js"></script>

    <script>
        function capitalizeMethod(method) {
            const methods = {
                'moncash': 'MonCash',
                'natcash': 'NatCash',
                'card': 'Credit Card',
                'bank': 'Bank Transfer'
            };
            return methods[method] || method;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Get donation data from URL parameters (passed by donation modal)
            const urlParams = new URLSearchParams(window.location.search);
            const donationId = urlParams.get('donation_id');
            const amount = urlParams.get('amount');
            const recipient = urlParams.get('recipient');
            const campaign = urlParams.get('campaign');
            const method = urlParams.get('method');
            const transactionRef = urlParams.get('ref');

            // If we have URL params, use them directly (faster)
            if (amount && recipient) {
                document.getElementById('donationAmount').innerHTML = `${parseFloat(amount).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} <span class="text-xl align-top text-primary">HTG</span>`;
                document.getElementById('recipientName').textContent = decodeURIComponent(recipient);

                if (campaign) {
                    document.getElementById('campaignTitle').textContent = decodeURIComponent(campaign);
                }

                if (method) {
                    document.getElementById('paymentMethod').textContent = capitalizeMethod(method);
                }

                if (transactionRef) {
                    document.getElementById('transactionId').textContent = transactionRef;
                }

                // Set default avatar
                const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(recipient)}&background=ea2a33&color=fff&size=128&bold=true`;
                document.getElementById('recipientAvatar').src = avatarUrl;

                // Load influencer data to get actual avatar
                if (urlParams.get('influencer_id')) {
                    try {
                        const response = await fetch(`/api/get-influencer.php?id=${urlParams.get('influencer_id')}`);
                        const result = await response.json();

                        if (result.success && result.influencer) {
                            const influencer = result.influencer;
                            if (influencer.avatar_url) {
                                document.getElementById('recipientAvatar').src = influencer.avatar_url;
                                document.getElementById('recipientBanner').style.backgroundImage = `url('${influencer.avatar_url}')`;
                            }
                        }
                    } catch (error) {
                        console.error('Error loading influencer details:', error);
                    }
                }
            }
            // Otherwise try to fetch from donation ID
            else if (donationId) {
                try {
                    const response = await fetch(`/api/get-donation.php?id=${donationId}`);
                    const result = await response.json();

                    if (result.success && result.donation) {
                        const donation = result.donation;

                        document.getElementById('donationAmount').innerHTML = `${parseFloat(donation.amount).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} <span class="text-xl align-top text-primary">HTG</span>`;
                        document.getElementById('recipientName').textContent = donation.influencer_name || 'Creator';
                        document.getElementById('campaignTitle').textContent = donation.campaign_title || 'Campaign';
                        document.getElementById('paymentMethod').textContent = capitalizeMethod(donation.payment_method);
                        document.getElementById('transactionId').textContent = donation.transaction_id || 'N/A';

                        const avatarUrl = donation.influencer_avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(donation.influencer_name)}&background=ea2a33&color=fff&size=128&bold=true`;
                        document.getElementById('recipientAvatar').src = avatarUrl;

                        if (donation.influencer_avatar) {
                            document.getElementById('recipientBanner').style.backgroundImage = `url('${donation.influencer_avatar}')`;
                        }
                    }
                } catch (error) {
                    console.error('Error loading donation details:', error);
                    // Show error message
                    document.getElementById('recipientName').textContent = 'Error loading data';
                    document.getElementById('campaignTitle').textContent = 'Please check your transaction history';
                }
            } else {
                // No data available - redirect to home
                console.error('No donation data provided');
                setTimeout(() => {
                    window.location.href = 'home.html';
                }, 3000);
            }
        });
    </script>
</body></html>