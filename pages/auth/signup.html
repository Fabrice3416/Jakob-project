<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>JaKòb - Sign Up</title>
    <!-- Favicon -->
    <link rel="icon" href="https://tse1.mm.bing.net/th/id/OIP.j5cceZXE70QB1K-TcN3-PQHaHa?r=0&rs=1&pid=ImgDetMain&o=7&rm=3" type="image/png"/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ea2a33",
                        "primary-dark": "#c91b24",
                        "background-dark": "#211111",
                        "surface-dark": "#2f1a1b",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "xl": "2rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: "FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24;
        }
    </style>
</head>
<body class="bg-background-dark font-display antialiased selection:bg-primary selection:text-white">
    <!-- Main Container -->
    <div class="relative flex min-h-screen w-full max-w-md mx-auto flex-col bg-background-dark">
        <!-- Header -->
        <header class="relative z-10 flex items-center justify-between p-4 pt-6">
            <a href="splash.html" class="flex size-10 items-center justify-center rounded-full bg-white/5 text-white hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
            <h2 class="text-base font-bold tracking-wide text-white">Sign Up</h2>
            <div class="size-10"></div>
        </header>

        <!-- Content -->
        <main class="relative z-10 flex flex-1 flex-col px-6 py-8">
            <!-- Logo -->
            <div class="flex flex-col items-center gap-4 mb-8">
                <div class="relative">
                    <div class="absolute inset-0 bg-primary/20 blur-xl rounded-full"></div>
                    <div class="relative bg-primary rounded-2xl p-6 shadow-[0_0_40px_rgba(234,42,51,0.4)]">
                        <img src="https://tse1.mm.bing.net/th/id/OIP.j5cceZXE70QB1K-TcN3-PQHaHa?r=0&rs=1&pid=ImgDetMain&o=7&rm=3" alt="JaKòb Logo" class="w-12 h-12"/>
                    </div>
                </div>
                <div class="text-center">
                    <h1 class="text-3xl font-black text-white mb-1">Create Account</h1>
                    <p class="text-white/60 text-sm">Join the JaKòb community</p>
                </div>
            </div>

            <!-- Alert Box -->
            <div id="msgBox" class="hidden mb-4 p-4 rounded-xl" role="alert"></div>

            <!-- Signup Form -->
            <form id="registerForm" class="space-y-4 flex-1">
                <!-- User Type Selection -->
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-white/80">I want to...</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="relative cursor-pointer">
                            <input type="radio" name="user_type" value="donor" checked class="sr-only peer"/>
                            <div class="p-4 rounded-xl bg-surface-dark border-2 border-white/10 peer-checked:border-primary peer-checked:bg-primary/10 transition-all text-center">
                                <span class="material-symbols-outlined text-primary text-3xl mb-2 block">volunteer_activism</span>
                                <p class="text-white font-bold text-sm">Support</p>
                                <p class="text-white/60 text-xs">Be a donor</p>
                            </div>
                        </label>
                        <label class="relative cursor-pointer">
                            <input type="radio" name="user_type" value="influencer" class="sr-only peer"/>
                            <div class="p-4 rounded-xl bg-surface-dark border-2 border-white/10 peer-checked:border-primary peer-checked:bg-primary/10 transition-all text-center">
                                <span class="material-symbols-outlined text-primary text-3xl mb-2 block">star</span>
                                <p class="text-white font-bold text-sm">Create</p>
                                <p class="text-white/60 text-xs">Be a creator</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Email Input -->
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-white/80" for="email">Email</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/40">
                            <span class="material-symbols-outlined !text-xl">email</span>
                        </span>
                        <input
                            type="email"
                            id="email"
                            placeholder="your@email.com"
                            required
                            class="w-full bg-surface-dark border border-white/10 rounded-xl pl-12 pr-4 py-3.5 text-white placeholder:text-white/30 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                        />
                    </div>
                </div>

                <!-- Phone Input -->
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-white/80" for="phone">Phone Number</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/40">
                            <span class="material-symbols-outlined !text-xl">phone</span>
                        </span>
                        <input
                            type="tel"
                            id="phone"
                            placeholder="+509 1234 5678"
                            required
                            class="w-full bg-surface-dark border border-white/10 rounded-xl pl-12 pr-4 py-3.5 text-white placeholder:text-white/30 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                        />
                    </div>
                </div>

                <!-- Password Input -->
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-white/80" for="password">Password</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/40">
                            <span class="material-symbols-outlined !text-xl">lock</span>
                        </span>
                        <input
                            type="password"
                            id="password"
                            placeholder="Create a strong password"
                            required
                            class="w-full bg-surface-dark border border-white/10 rounded-xl pl-12 pr-12 py-3.5 text-white placeholder:text-white/30 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                        />
                        <button type="button" id="togglePassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/40 hover:text-white/70">
                            <span class="material-symbols-outlined !text-xl">visibility</span>
                        </button>
                    </div>
                </div>

                <!-- Terms Checkbox -->
                <label class="flex items-start gap-3 cursor-pointer">
                    <input type="checkbox" id="terms" required class="mt-1 size-4 rounded border-white/10 bg-surface-dark text-primary focus:ring-primary/20"/>
                    <span class="text-white/70 text-sm">
                        I agree to the <a href="#" class="text-primary font-semibold">Terms of Service</a> and <a href="#" class="text-primary font-semibold">Privacy Policy</a>
                    </span>
                </label>

                <!-- Sign Up Button -->
                <button type="submit" id="btnSubmit" class="w-full bg-primary hover:bg-primary-dark active:scale-[0.98] transition-all text-white font-bold py-4 rounded-full shadow-[0_4px_20px_rgba(234,42,51,0.4)] mt-6">
                    Create Account
                </button>
            </form>

            <!-- Sign In Link -->
            <div class="text-center py-6">
                <p class="text-white/60 text-sm">
                    Already have an account?
                    <a href="login.html" class="text-primary font-bold hover:text-primary-dark">Sign In</a>
                </p>
            </div>
        </main>
    </div>

    <script>
        // Password visibility toggle
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const icon = this.querySelector('.material-symbols-outlined');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.textContent = 'visibility_off';
            } else {
                passwordInput.type = 'password';
                icon.textContent = 'visibility';
            }
        });

        // Form submission
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const btn = document.getElementById('btnSubmit');
            const msg = document.getElementById('msgBox');
            const originalText = btn.textContent;

            // Get form data
            const userType = document.querySelector('input[name="user_type"]:checked').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;

            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin">progress_activity</span> Creating account...';
            msg.classList.add('hidden');

            try {
                const response = await fetch('../../api/register.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_type: userType,
                        email: email,
                        phone: phone,
                        password: password
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Store pending profile completion in sessionStorage
                    sessionStorage.setItem('pendingProfileCompletion', JSON.stringify({
                        user_type: userType
                    }));

                    // Success message
                    msg.className = 'mb-4 p-4 rounded-xl bg-green-500/20 border border-green-500/30 text-green-400';
                    msg.innerHTML = `
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined">check_circle</span>
                            <div>
                                <p class="font-bold mb-1">Account created!</p>
                                <p class="text-sm">Let's complete your profile...</p>
                            </div>
                        </div>
                    `;
                    msg.classList.remove('hidden');

                    // Redirect to complete-profile page
                    setTimeout(() => {
                        window.location.href = 'complete-profile.html';
                    }, 1500);
                } else {
                    // Error message
                    msg.className = 'mb-4 p-4 rounded-xl bg-red-500/20 border border-red-500/30 text-red-400';
                    msg.innerHTML = `
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined">error</span>
                            <div>
                                <p class="font-bold mb-1">Registration failed</p>
                                <p class="text-sm">${data.message || 'Please try again'}</p>
                            </div>
                        </div>
                    `;
                    msg.classList.remove('hidden');

                    btn.disabled = false;
                    btn.textContent = originalText;
                }
            } catch (error) {
                console.error('Error:', error);

                msg.className = 'mb-4 p-4 rounded-xl bg-red-500/20 border border-red-500/30 text-red-400';
                msg.innerHTML = `
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined">error</span>
                        <div>
                            <p class="font-bold mb-1">Connection error</p>
                            <p class="text-sm">Please check your internet connection</p>
                        </div>
                    </div>
                `;
                msg.classList.remove('hidden');

                btn.disabled = false;
                btn.textContent = originalText;
            }
        });
    </script>
</body>
</html>
