<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>JaKòb - Sign In</title>
    <!-- Favicon -->
    <link rel="icon" href="https://tse1.mm.bing.net/th/id/OIP.j5cceZXE70QB1K-TcN3-PQHaHa?r=0&rs=1&pid=ImgDetMain&o=7&rm=3" type="image/png"/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ea2a33",
                        "primary-dark": "#c91b24",
                        "background-light": "#f8f6f6",
                        "background-dark": "#211111",
                        "surface-dark": "#2f1a1b",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "sm": "0.5rem",
                        "md": "0.75rem",
                        "lg": "1.5rem",
                        "xl": "2rem",
                        "2xl": "2.5rem",
                        "3xl": "3rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: "FILL" 1, "wght" 400, "GRAD" 0, "opsz" 24;
        }
    </style>
</head>
<body class="bg-background-dark font-display antialiased selection:bg-primary selection:text-white">
    <!-- Main Container -->
    <div class="relative flex min-h-screen w-full max-w-md mx-auto flex-col bg-background-dark">
        <!-- Header -->
        <header class="relative z-10 flex items-center justify-between p-4 pt-6">
            <a href="splash.html" class="flex size-10 items-center justify-center rounded-full bg-white/5 text-white hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
            <h2 class="text-base font-bold tracking-wide text-white/80">Sign In</h2>
            <div class="size-10"></div>
        </header>

        <!-- Content -->
        <main class="relative z-10 flex flex-1 flex-col px-6 py-8">
            <!-- Logo -->
            <div class="flex flex-col items-center gap-4 mb-8">
                <div class="relative">
                    <div class="absolute inset-0 bg-primary/20 blur-xl rounded-full"></div>
                    <div class="relative bg-primary rounded-2xl p-6 shadow-[0_0_40px_rgba(234,42,51,0.4)]">
                        <img src="https://tse1.mm.bing.net/th/id/OIP.j5cceZXE70QB1K-TcN3-PQHaHa?r=0&rs=1&pid=ImgDetMain&o=7&rm=3" alt="JaKòb Logo" class="w-12 h-12"/>
                    </div>
                </div>
                <div class="text-center">
                    <h1 class="text-3xl font-black text-white mb-1">Welcome Back!</h1>
                    <p class="text-white/60 text-sm">Byenveni ankò nan JaKòb</p>
                </div>
            </div>

            <!-- Alert Box -->
            <div id="msgBox" class="hidden mb-4 p-4 rounded-xl" role="alert"></div>

            <!-- Login Form -->
            <form id="loginForm" class="space-y-4 flex-1">
                <!-- Phone Number Input -->
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-white/80" for="phone">Phone Number</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/40">
                            <span class="material-symbols-outlined !text-xl">phone</span>
                        </span>
                        <input
                            type="tel"
                            id="phone"
                            placeholder="+509 1234 5678"
                            required
                            class="w-full bg-surface-dark border border-white/10 rounded-xl pl-12 pr-4 py-3.5 text-white placeholder:text-white/30 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                        />
                    </div>
                </div>

                <!-- Password Input -->
                <div class="space-y-2">
                    <label class="text-sm font-semibold text-white/80" for="password">Password</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/40">
                            <span class="material-symbols-outlined !text-xl">lock</span>
                        </span>
                        <input
                            type="password"
                            id="password"
                            placeholder="Enter your password"
                            required
                            class="w-full bg-surface-dark border border-white/10 rounded-xl pl-12 pr-12 py-3.5 text-white placeholder:text-white/30 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                        />
                        <button type="button" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/40 hover:text-white/70">
                            <span class="material-symbols-outlined !text-xl">visibility</span>
                        </button>
                    </div>
                </div>

                <!-- Remember Me & Forgot Password -->
                <div class="flex items-center justify-between text-sm">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="rememberMe" class="size-4 rounded border-white/10 bg-surface-dark text-primary focus:ring-primary/20"/>
                        <span class="text-white/70">Remember me</span>
                    </label>
                    <a href="#" class="text-primary font-semibold hover:text-primary-dark">Forgot password?</a>
                </div>

                <!-- Sign In Button -->
                <button type="submit" id="btnSubmit" class="w-full bg-primary hover:bg-primary-dark active:scale-[0.98] transition-all text-white font-bold py-4 rounded-full shadow-[0_4px_20px_rgba(234,42,51,0.4)] mt-6">
                    Sign In
                </button>

                <!-- Divider -->
                <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-white/10"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-4 text-white/40 bg-background-dark">Or continue with</span>
                    </div>
                </div>

                <!-- Social Login Buttons -->
                <div class="grid grid-cols-2 gap-3">
                    <button type="button" class="flex items-center justify-center gap-2 bg-white/5 hover:bg-white/10 border border-white/10 text-white font-semibold py-3 rounded-xl transition-all">
                        <span class="material-symbols-outlined">phone_iphone</span>
                        <span class="text-sm">MonCash</span>
                    </button>
                    <button type="button" class="flex items-center justify-center gap-2 bg-white/5 hover:bg-white/10 border border-white/10 text-white font-semibold py-3 rounded-xl transition-all">
                        <span class="material-symbols-outlined">account_balance_wallet</span>
                        <span class="text-sm">NatCash</span>
                    </button>
                </div>
            </form>

            <!-- Sign Up Link -->
            <div class="text-center py-6">
                <p class="text-white/60 text-sm">
                    Don't have an account?
                    <a href="signup.html" class="text-primary font-bold hover:text-primary-dark">Sign Up</a>
                </p>
            </div>
        </main>
    </div>

    <script>
        // Password visibility toggle
        document.querySelector('button[type="button"]').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const icon = this.querySelector('.material-symbols-outlined');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.textContent = 'visibility_off';
            } else {
                passwordInput.type = 'password';
                icon.textContent = 'visibility';
            }
        });

        // Form submission
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const btn = document.getElementById('btnSubmit');
            const msg = document.getElementById('msgBox');
            const originalText = btn.textContent;

            // Get form data
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin">progress_activity</span> Signing in...';
            msg.classList.add('hidden');

            try {
                const response = await fetch('../../api/login.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        phone: phone,
                        password: password,
                        remember_me: rememberMe
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Success message
                    msg.className = 'mb-4 p-4 rounded-xl bg-green-500/20 border border-green-500/30 text-green-400';
                    msg.innerHTML = `
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined">check_circle</span>
                            <div>
                                <p class="font-bold mb-1">Welcome back!</p>
                                <p class="text-sm">Redirecting to your dashboard...</p>
                            </div>
                        </div>
                    `;
                    msg.classList.remove('hidden');

                    // Redirect based on user type after 2 seconds
                    setTimeout(() => {
                        if (data.data.user_type === 'donor') {
                            window.location.href = '../main/home.html';
                        } else {
                            window.location.href = '../creator/my-campaigns.html';
                        }
                    }, 2000);
                } else {
                    // Error message
                    msg.className = 'mb-4 p-4 rounded-xl bg-red-500/20 border border-red-500/30 text-red-400';
                    msg.innerHTML = `
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined">error</span>
                            <div>
                                <p class="font-bold mb-1">Login failed</p>
                                <p class="text-sm">${data.message || 'Please try again'}</p>
                            </div>
                        </div>
                    `;
                    msg.classList.remove('hidden');

                    btn.disabled = false;
                    btn.textContent = originalText;
                }
            } catch (error) {
                console.error('Error:', error);

                msg.className = 'mb-4 p-4 rounded-xl bg-red-500/20 border border-red-500/30 text-red-400';
                msg.innerHTML = `
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined">error</span>
                        <div>
                            <p class="font-bold mb-1">Connection error</p>
                            <p class="text-sm">Please check your internet connection</p>
                        </div>
                    </div>
                `;
                msg.classList.remove('hidden');

                btn.disabled = false;
                btn.textContent = originalText;
            }
        });
    </script>
</body>
</html>
